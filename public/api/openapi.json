{
  "openapi": "3.1.0",
  "info": {
    "title": "VerJSON API",
    "version": "1.2.0",
    "description": "API for managing JSON Schema and OpenAPI documents with versioning, collaboration, and Crowdin integration. Use the public API gateway with API key authentication for programmatic access.",
    "contact": {
      "name": "VerJSON Support"
    }
  },
  "servers": [
    {
      "url": "https://swghcmyqracwifpdfyap.supabase.co/functions/v1/api",
      "description": "Public API Gateway"
    }
  ],
  "tags": [
    {
      "name": "Workspaces",
      "description": "Workspace management operations"
    },
    {
      "name": "Documents",
      "description": "Document management operations"
    },
    {
      "name": "Versions",
      "description": "Document version management"
    },
    {
      "name": "Permissions",
      "description": "Permission and invitation management"
    },
    {
      "name": "Notifications",
      "description": "User notification management"
    },
    {
      "name": "User",
      "description": "User profile management"
    },
    {
      "name": "API Keys",
      "description": "API key management for programmatic access"
    },
    {
      "name": "Crowdin",
      "description": "Crowdin integration operations"
    },
    {
      "name": "Public",
      "description": "Public endpoints (no authentication required)"
    }
  ],
  "paths": {
    "/workspaces": {
      "post": {
        "tags": ["Workspaces"],
        "summary": "Workspace management",
        "description": "Manage workspaces - list, create, update, or delete. All requests go through the API gateway with API key authentication.",
        "operationId": "workspaceManagement",
        "security": [{ "apiKeyAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "oneOf": [
                  { "$ref": "#/components/schemas/ListUserWorkspacesRequest" },
                  { "$ref": "#/components/schemas/CreateWorkspaceRequest" },
                  { "$ref": "#/components/schemas/UpdateWorkspaceRequest" },
                  { "$ref": "#/components/schemas/DeleteWorkspaceRequest" }
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful operation",
            "content": {
              "application/json": {
                "schema": {
                  "oneOf": [
                    { "$ref": "#/components/schemas/WorkspaceListResponse" },
                    { "$ref": "#/components/schemas/WorkspaceResponse" },
                    { "$ref": "#/components/schemas/SuccessResponse" }
                  ]
                }
              }
            }
          },
          "400": { "$ref": "#/components/responses/BadRequest" },
          "401": { "$ref": "#/components/responses/Unauthorized" },
          "403": { "$ref": "#/components/responses/Forbidden" },
          "500": { "$ref": "#/components/responses/InternalError" }
        }
      }
    },
    "/documents": {
      "post": {
        "tags": ["Documents"],
        "summary": "Document management",
        "description": "Manage documents - list, create, update, delete, or list shared documents. All requests go through the API gateway with API key authentication.",
        "operationId": "documentManagement",
        "security": [{ "apiKeyAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "oneOf": [
                  { "$ref": "#/components/schemas/ListDocumentsByWorkspaceRequest" },
                  { "$ref": "#/components/schemas/CreateDocumentRequest" },
                  { "$ref": "#/components/schemas/UpdateDocumentRequest" },
                  { "$ref": "#/components/schemas/DeleteDocumentRequest" },
                  { "$ref": "#/components/schemas/ListSharedDocumentsRequest" }
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful operation",
            "content": {
              "application/json": {
                "schema": {
                  "oneOf": [
                    { "$ref": "#/components/schemas/DocumentListResponse" },
                    { "$ref": "#/components/schemas/DocumentResponse" },
                    { "$ref": "#/components/schemas/SuccessResponse" }
                  ]
                }
              }
            }
          },
          "400": { "$ref": "#/components/responses/BadRequest" },
          "401": { "$ref": "#/components/responses/Unauthorized" },
          "403": { "$ref": "#/components/responses/Forbidden" },
          "500": { "$ref": "#/components/responses/InternalError" }
        }
      }
    },
    "/versions": {
      "post": {
        "tags": ["Versions"],
        "summary": "Document version management",
        "description": "Manage document versions - list, create, update, delete, approve, or reject. Supports API key authentication with scope-based access control (read, write, admin).",
        "operationId": "documentVersions",
        "security": [{ "apiKeyAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "oneOf": [
                  { "$ref": "#/components/schemas/ListDocumentVersionsRequest" },
                  { "$ref": "#/components/schemas/GetDocumentVersionRequest" },
                  { "$ref": "#/components/schemas/GetVersionDiffRequest" },
                  { "$ref": "#/components/schemas/CreateDocumentVersionRequest" },
                  { "$ref": "#/components/schemas/UpdateDocumentVersionRequest" },
                  { "$ref": "#/components/schemas/DeleteDocumentVersionRequest" },
                  { "$ref": "#/components/schemas/ApproveVersionRequest" },
                  { "$ref": "#/components/schemas/RejectVersionRequest" }
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful operation",
            "content": {
              "application/json": {
                "schema": {
                  "oneOf": [
                    { "$ref": "#/components/schemas/VersionListResponse" },
                    { "$ref": "#/components/schemas/VersionResponse" },
                    { "$ref": "#/components/schemas/VersionContentResponse" },
                    { "$ref": "#/components/schemas/VersionDiffResponse" },
                    { "$ref": "#/components/schemas/SuccessResponse" }
                  ]
                }
              }
            }
          },
          "400": { "$ref": "#/components/responses/BadRequest" },
          "401": { "$ref": "#/components/responses/Unauthorized" },
          "403": { "$ref": "#/components/responses/Forbidden" },
          "404": { "$ref": "#/components/responses/NotFound" },
          "500": { "$ref": "#/components/responses/InternalError" }
        }
      }
    },
    "/permissions": {
      "post": {
        "tags": ["Permissions"],
        "summary": "Permission management",
        "description": "Manage permissions and invitations for workspaces and documents. All requests go through the API gateway with API key authentication.",
        "operationId": "permissionsManagement",
        "security": [{ "apiKeyAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "oneOf": [
                  { "$ref": "#/components/schemas/GetDocumentPermissionsRequest" },
                  { "$ref": "#/components/schemas/GetWorkspacePermissionsRequest" },
                  { "$ref": "#/components/schemas/UpdatePermissionRequest" },
                  { "$ref": "#/components/schemas/RemovePermissionRequest" },
                  { "$ref": "#/components/schemas/InviteToDocumentRequest" },
                  { "$ref": "#/components/schemas/InviteToWorkspaceRequest" },
                  { "$ref": "#/components/schemas/GetUserInvitationsRequest" },
                  { "$ref": "#/components/schemas/AcceptInvitationRequest" },
                  { "$ref": "#/components/schemas/DeclineInvitationRequest" }
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful operation",
            "content": {
              "application/json": {
                "schema": {
                  "oneOf": [
                    { "$ref": "#/components/schemas/PermissionListResponse" },
                    { "$ref": "#/components/schemas/InvitationListResponse" },
                    { "$ref": "#/components/schemas/SuccessResponse" }
                  ]
                }
              }
            }
          },
          "400": { "$ref": "#/components/responses/BadRequest" },
          "401": { "$ref": "#/components/responses/Unauthorized" },
          "403": { "$ref": "#/components/responses/Forbidden" },
          "500": { "$ref": "#/components/responses/InternalError" }
        }
      }
    },
    "/notifications": {
      "post": {
        "tags": ["Notifications"],
        "summary": "Notification management",
        "description": "Manage user notifications - list, mark as read, or create. All requests go through the API gateway with API key authentication.",
        "operationId": "notificationsManagement",
        "security": [{ "apiKeyAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "oneOf": [
                  { "$ref": "#/components/schemas/GetUserNotificationsRequest" },
                  { "$ref": "#/components/schemas/MarkNotificationAsReadRequest" },
                  { "$ref": "#/components/schemas/MarkAllNotificationsAsReadRequest" },
                  { "$ref": "#/components/schemas/CreateNotificationRequest" }
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful operation",
            "content": {
              "application/json": {
                "schema": {
                  "oneOf": [
                    { "$ref": "#/components/schemas/NotificationListResponse" },
                    { "$ref": "#/components/schemas/NotificationResponse" },
                    { "$ref": "#/components/schemas/SuccessResponse" }
                  ]
                }
              }
            }
          },
          "400": { "$ref": "#/components/responses/BadRequest" },
          "401": { "$ref": "#/components/responses/Unauthorized" },
          "403": { "$ref": "#/components/responses/Forbidden" },
          "500": { "$ref": "#/components/responses/InternalError" }
        }
      }
    },
    "/profile": {
      "post": {
        "tags": ["User"],
        "summary": "User profile management",
        "description": "Get or update user profile. All requests go through the API gateway with API key authentication.",
        "operationId": "userProfile",
        "security": [{ "apiKeyAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "oneOf": [
                  { "$ref": "#/components/schemas/GetUserProfileRequest" },
                  { "$ref": "#/components/schemas/UpdateUserProfileRequest" }
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful operation",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserProfileResponse"
                }
              }
            }
          },
          "401": { "$ref": "#/components/responses/Unauthorized" },
          "403": { "$ref": "#/components/responses/Forbidden" },
          "500": { "$ref": "#/components/responses/InternalError" }
        }
      }
    },
    "/api-keys": {
      "post": {
        "tags": ["API Keys"],
        "summary": "API key management",
        "description": "Manage API keys for programmatic access - list, create, update, revoke, or delete. API keys provide secure authentication for automated workflows and integrations.",
        "operationId": "apiKeyManagement",
        "security": [{ "bearerAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "oneOf": [
                  { "$ref": "#/components/schemas/ListApiKeysRequest" },
                  { "$ref": "#/components/schemas/CreateApiKeyRequest" },
                  { "$ref": "#/components/schemas/UpdateApiKeyRequest" },
                  { "$ref": "#/components/schemas/RevokeApiKeyRequest" },
                  { "$ref": "#/components/schemas/DeleteApiKeyRequest" }
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful operation",
            "content": {
              "application/json": {
                "schema": {
                  "oneOf": [
                    { "$ref": "#/components/schemas/ApiKeyListResponse" },
                    { "$ref": "#/components/schemas/ApiKeyCreatedResponse" },
                    { "$ref": "#/components/schemas/ApiKeyResponse" },
                    { "$ref": "#/components/schemas/SuccessResponse" }
                  ]
                }
              }
            }
          },
          "400": { "$ref": "#/components/responses/BadRequest" },
          "401": { "$ref": "#/components/responses/Unauthorized" },
          "500": { "$ref": "#/components/responses/InternalError" }
        }
      }
    },
    "/crowdin": {
      "post": {
        "tags": ["Crowdin"],
        "summary": "Crowdin integration",
        "description": "Manage Crowdin translation integration - list projects, export/import translations. All requests go through the API gateway with API key authentication.",
        "operationId": "crowdinIntegration",
        "security": [{ "apiKeyAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["action"],
                "properties": {
                  "action": {
                    "type": "string",
                    "enum": ["listProjects", "listProjectFiles", "exportToFile", "importFromFile", "checkImportStatus"]
                  },
                  "workspaceId": { "type": "string", "format": "uuid" },
                  "projectId": { "type": "string" },
                  "documentId": { "type": "string", "format": "uuid" }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful operation",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object"
                }
              }
            }
          },
          "401": { "$ref": "#/components/responses/Unauthorized" },
          "403": { "$ref": "#/components/responses/Forbidden" },
          "500": { "$ref": "#/components/responses/InternalError" }
        }
      }
    },
    "/public-document": {
      "get": {
        "tags": ["Public"],
        "summary": "Get public document",
        "description": "Retrieve a publicly accessible document by ID",
        "operationId": "getPublicDocument",
        "parameters": [
          {
            "name": "id",
            "in": "query",
            "required": true,
            "schema": { "type": "string", "format": "uuid" },
            "description": "Document ID"
          },
          {
            "name": "format",
            "in": "query",
            "required": false,
            "schema": { "type": "string", "enum": ["json", "confluence"] },
            "description": "Response format"
          },
          {
            "name": "metadata",
            "in": "query",
            "required": false,
            "schema": { "type": "string", "enum": ["true", "false"] },
            "description": "Include metadata in response"
          }
        ],
        "responses": {
          "200": {
            "description": "Document content",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/PublicDocumentResponse" }
              }
            }
          },
          "400": { "$ref": "#/components/responses/BadRequest" },
          "403": { "$ref": "#/components/responses/Forbidden" },
          "404": { "$ref": "#/components/responses/NotFound" },
          "500": { "$ref": "#/components/responses/InternalError" }
        }
      }
    },
    "/public-diagram": {
      "get": {
        "tags": ["Public"],
        "summary": "Get public diagram",
        "description": "Retrieve a publicly accessible diagram by ID, optionally as PNG/SVG image",
        "operationId": "getPublicDiagram",
        "parameters": [
          {
            "name": "id",
            "in": "query",
            "required": true,
            "schema": { "type": "string", "format": "uuid" },
            "description": "Diagram document ID"
          },
          {
            "name": "theme",
            "in": "query",
            "required": false,
            "schema": { "type": "string", "enum": ["light", "dark"] },
            "description": "Theme for diagram rendering"
          },
          {
            "name": "format",
            "in": "query",
            "required": false,
            "schema": { "type": "string", "enum": ["json", "png", "svg"] },
            "description": "Response format"
          },
          {
            "name": "style_theme",
            "in": "query",
            "required": false,
            "schema": { "type": "string" },
            "description": "Style theme for image renders"
          }
        ],
        "responses": {
          "200": {
            "description": "Diagram content or image",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/PublicDiagramResponse" }
              },
              "image/png": {
                "schema": { "type": "string", "format": "binary" }
              },
              "image/svg+xml": {
                "schema": { "type": "string" }
              }
            }
          },
          "400": { "$ref": "#/components/responses/BadRequest" },
          "403": { "$ref": "#/components/responses/Forbidden" },
          "404": { "$ref": "#/components/responses/NotFound" },
          "500": { "$ref": "#/components/responses/InternalError" }
        }
      }
    },
    "/demo-session": {
      "post": {
        "tags": ["Public"],
        "summary": "Create demo session",
        "description": "Create a temporary demo session for trying out the application",
        "operationId": "createDemoSession",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["action"],
                "properties": {
                  "action": { "type": "string", "enum": ["createDemoSession"] }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Demo session created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean" },
                    "email": { "type": "string" },
                    "password": { "type": "string" },
                    "expiresAt": { "type": "string", "format": "date-time" }
                  }
                }
              }
            }
          },
          "500": { "$ref": "#/components/responses/InternalError" }
        }
      }
    }
  },
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT",
        "description": "JWT token from Supabase Auth. Obtain by signing in via the web interface or using Supabase auth endpoints."
      },
      "apiKeyAuth": {
        "type": "apiKey",
        "in": "header",
        "name": "X-API-Key",
        "description": "API key for programmatic access. Generate keys in Account Settings > API Keys. Keys have format 'vj_XXXXX...' and support scopes: read, write, admin. Can also be passed as Bearer token with 'vj_' prefix."
      }
    },
    "schemas": {
      "ApiKeyScope": {
        "type": "string",
        "enum": ["read", "write", "admin"],
        "description": "API key access scope. 'read' allows viewing data, 'write' allows creating/updating data, 'admin' grants full access including deletions and permission management."
      },
      "ListApiKeysRequest": {
        "type": "object",
        "required": ["action"],
        "properties": {
          "action": { "type": "string", "enum": ["list"] }
        }
      },
      "CreateApiKeyRequest": {
        "type": "object",
        "required": ["action", "name", "scopes"],
        "properties": {
          "action": { "type": "string", "enum": ["create"] },
          "name": { "type": "string", "description": "Descriptive name for the API key" },
          "scopes": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/ApiKeyScope" },
            "description": "Access scopes for the key"
          },
          "expiresAt": { 
            "type": "string", 
            "format": "date-time",
            "nullable": true,
            "description": "Optional expiration date. If not set, key never expires."
          }
        }
      },
      "UpdateApiKeyRequest": {
        "type": "object",
        "required": ["action", "keyId"],
        "properties": {
          "action": { "type": "string", "enum": ["update"] },
          "keyId": { "type": "string", "format": "uuid" },
          "name": { "type": "string" },
          "scopes": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/ApiKeyScope" }
          },
          "expiresAt": { 
            "type": "string", 
            "format": "date-time",
            "nullable": true
          }
        }
      },
      "RevokeApiKeyRequest": {
        "type": "object",
        "required": ["action", "keyId"],
        "properties": {
          "action": { "type": "string", "enum": ["revoke"] },
          "keyId": { "type": "string", "format": "uuid" }
        }
      },
      "DeleteApiKeyRequest": {
        "type": "object",
        "required": ["action", "keyId"],
        "properties": {
          "action": { "type": "string", "enum": ["delete"] },
          "keyId": { "type": "string", "format": "uuid" }
        }
      },
      "ApiKey": {
        "type": "object",
        "properties": {
          "id": { "type": "string", "format": "uuid" },
          "name": { "type": "string" },
          "key_prefix": { "type": "string", "description": "First 8 characters of the key for identification" },
          "scopes": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/ApiKeyScope" }
          },
          "is_active": { "type": "boolean" },
          "last_used_at": { "type": "string", "format": "date-time", "nullable": true },
          "expires_at": { "type": "string", "format": "date-time", "nullable": true },
          "created_at": { "type": "string", "format": "date-time" },
          "updated_at": { "type": "string", "format": "date-time" }
        }
      },
      "ApiKeyListResponse": {
        "type": "object",
        "properties": {
          "apiKeys": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/ApiKey" }
          }
        }
      },
      "ApiKeyCreatedResponse": {
        "type": "object",
        "properties": {
          "apiKey": { "$ref": "#/components/schemas/ApiKey" },
          "key": { 
            "type": "string", 
            "description": "The full API key. Only returned once on creation - store it securely!"
          }
        }
      },
      "ApiKeyResponse": {
        "type": "object",
        "properties": {
          "success": { "type": "boolean" },
          "apiKey": { "$ref": "#/components/schemas/ApiKey" }
        }
      },
      "PermissionRole": {
        "type": "string",
        "enum": ["owner", "editor", "viewer"]
      },
      "FileType": {
        "type": "string",
        "enum": ["json-schema", "openapi", "diagram"]
      },
      "VersionTier": {
        "type": "string",
        "enum": ["major", "minor", "patch"]
      },
      "ListUserWorkspacesRequest": {
        "type": "object",
        "required": ["action"],
        "properties": {
          "action": { "type": "string", "enum": ["listUserWorkspaces"] }
        }
      },
      "CreateWorkspaceRequest": {
        "type": "object",
        "required": ["action", "name"],
        "properties": {
          "action": { "type": "string", "enum": ["createWorkspace"] },
          "name": { "type": "string" },
          "description": { "type": "string" }
        }
      },
      "UpdateWorkspaceRequest": {
        "type": "object",
        "required": ["action", "id"],
        "properties": {
          "action": { "type": "string", "enum": ["updateWorkspace"] },
          "id": { "type": "string", "format": "uuid" },
          "name": { "type": "string" },
          "description": { "type": "string" }
        }
      },
      "DeleteWorkspaceRequest": {
        "type": "object",
        "required": ["action", "id"],
        "properties": {
          "action": { "type": "string", "enum": ["deleteWorkspace"] },
          "id": { "type": "string", "format": "uuid" }
        }
      },
      "Workspace": {
        "type": "object",
        "properties": {
          "id": { "type": "string", "format": "uuid" },
          "name": { "type": "string" },
          "description": { "type": "string", "nullable": true },
          "user_id": { "type": "string", "format": "uuid" },
          "created_at": { "type": "string", "format": "date-time" },
          "updated_at": { "type": "string", "format": "date-time" },
          "collaboratorCount": { "type": "integer" },
          "isOwner": { "type": "boolean" },
          "role": { "$ref": "#/components/schemas/PermissionRole" }
        }
      },
      "WorkspaceListResponse": {
        "type": "object",
        "properties": {
          "workspaces": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/Workspace" }
          }
        }
      },
      "WorkspaceResponse": {
        "type": "object",
        "properties": {
          "workspace": { "$ref": "#/components/schemas/Workspace" }
        }
      },
      "ListDocumentsByWorkspaceRequest": {
        "type": "object",
        "required": ["action", "workspace_id"],
        "properties": {
          "action": { "type": "string", "enum": ["listDocumentsByWorkspace"] },
          "workspace_id": { "type": "string", "format": "uuid" }
        }
      },
      "CreateDocumentRequest": {
        "type": "object",
        "required": ["action", "workspace_id", "name", "file_type"],
        "properties": {
          "action": { "type": "string", "enum": ["createDocument"] },
          "workspace_id": { "type": "string", "format": "uuid" },
          "name": { "type": "string" },
          "content": { "type": "object" },
          "file_type": { "$ref": "#/components/schemas/FileType" },
          "import_url": { "type": "string", "format": "uri" },
          "import_auth_method": { "type": "string", "enum": ["basic", "bearer"] },
          "import_auth_credentials": { "type": "string" }
        }
      },
      "UpdateDocumentRequest": {
        "type": "object",
        "required": ["action", "id"],
        "properties": {
          "action": { "type": "string", "enum": ["updateDocument"] },
          "id": { "type": "string", "format": "uuid" },
          "name": { "type": "string" },
          "content": { "type": "object" },
          "file_type": { "$ref": "#/components/schemas/FileType" }
        }
      },
      "DeleteDocumentRequest": {
        "type": "object",
        "required": ["action", "id"],
        "properties": {
          "action": { "type": "string", "enum": ["deleteDocument"] },
          "id": { "type": "string", "format": "uuid" }
        }
      },
      "ListSharedDocumentsRequest": {
        "type": "object",
        "required": ["action"],
        "properties": {
          "action": { "type": "string", "enum": ["listSharedDocuments"] }
        }
      },
      "Document": {
        "type": "object",
        "properties": {
          "id": { "type": "string", "format": "uuid" },
          "name": { "type": "string" },
          "workspace_id": { "type": "string", "format": "uuid" },
          "user_id": { "type": "string", "format": "uuid" },
          "file_type": { "$ref": "#/components/schemas/FileType" },
          "created_at": { "type": "string", "format": "date-time" },
          "updated_at": { "type": "string", "format": "date-time" },
          "import_url": { "type": "string", "format": "uri", "nullable": true },
          "crowdin_integration_id": { "type": "string", "format": "uuid", "nullable": true }
        }
      },
      "DocumentListResponse": {
        "type": "object",
        "properties": {
          "documents": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/Document" }
          }
        }
      },
      "DocumentResponse": {
        "type": "object",
        "properties": {
          "document": { "$ref": "#/components/schemas/Document" }
        }
      },
      "ListDocumentVersionsRequest": {
        "type": "object",
        "required": ["action", "documentId"],
        "properties": {
          "action": { "type": "string", "enum": ["listDocumentVersions"] },
          "documentId": { "type": "string", "format": "uuid" }
        }
      },
      "CreateDocumentVersionRequest": {
        "type": "object",
        "required": ["action", "documentId", "patch"],
        "properties": {
          "action": { "type": "string", "enum": ["createDocumentVersion"] },
          "documentId": { "type": "string", "format": "uuid" },
          "patch": {
            "type": "object",
            "properties": {
              "version": {
                "type": "object",
                "properties": {
                  "major": { "type": "integer" },
                  "minor": { "type": "integer" },
                  "patch": { "type": "integer" }
                }
              },
              "description": { "type": "string" },
              "tier": { "$ref": "#/components/schemas/VersionTier" },
              "isReleased": { "type": "boolean" },
              "isSelected": { "type": "boolean" },
              "patches": { "type": "array" },
              "fullDocument": { "type": "object" }
            }
          }
        }
      },
      "UpdateDocumentVersionRequest": {
        "type": "object",
        "required": ["action", "versionId"],
        "properties": {
          "action": { "type": "string", "enum": ["updateDocumentVersion"] },
          "versionId": { "type": "string", "format": "uuid" },
          "updates": { "type": "object" }
        }
      },
      "DeleteDocumentVersionRequest": {
        "type": "object",
        "required": ["action", "versionId"],
        "properties": {
          "action": { "type": "string", "enum": ["deleteDocumentVersion"] },
          "versionId": { "type": "string", "format": "uuid" }
        }
      },
      "ApproveVersionRequest": {
        "type": "object",
        "required": ["action", "versionId"],
        "properties": {
          "action": { "type": "string", "enum": ["approvePendingVersion"] },
          "versionId": { "type": "string", "format": "uuid" }
        }
      },
      "RejectVersionRequest": {
        "type": "object",
        "required": ["action", "versionId"],
        "properties": {
          "action": { "type": "string", "enum": ["rejectPendingVersion"] },
          "versionId": { "type": "string", "format": "uuid" }
        }
      },
      "GetDocumentVersionRequest": {
        "type": "object",
        "required": ["action", "documentId", "versionId"],
        "properties": {
          "action": { "type": "string", "enum": ["getDocumentVersion"] },
          "documentId": { "type": "string", "format": "uuid", "description": "ID of the document" },
          "versionId": { "type": "string", "format": "uuid", "description": "ID of the version to retrieve" }
        },
        "description": "Retrieve the effective document content at a specific version by applying all patches up to that version"
      },
      "GetVersionDiffRequest": {
        "type": "object",
        "required": ["action", "documentId", "fromVersionId", "toVersionId"],
        "properties": {
          "action": { "type": "string", "enum": ["getVersionDiff"] },
          "documentId": { "type": "string", "format": "uuid", "description": "ID of the document" },
          "fromVersionId": { "type": "string", "format": "uuid", "description": "ID of the source version to compare from" },
          "toVersionId": { "type": "string", "format": "uuid", "description": "ID of the target version to compare to" },
          "format": { 
            "type": "string", 
            "enum": ["simple", "complex"],
            "default": "complex",
            "description": "Output format: 'complex' returns JSON Patch operations (default), 'simple' returns pseudo-JSON text with comments showing structural changes"
          }
        },
        "description": "Generate a diff between two document versions. The 'complex' format returns detailed JSON Patch operations while 'simple' format returns a human-readable pseudo-JSON text where additions are shown normally, removals are commented out (// for single-line, /* */ for multi-line), and modifications show both old (commented) and new values."
      },
      "DocumentVersion": {
        "type": "object",
        "properties": {
          "id": { "type": "string", "format": "uuid" },
          "document_id": { "type": "string", "format": "uuid" },
          "user_id": { "type": "string", "format": "uuid" },
          "version_major": { "type": "integer" },
          "version_minor": { "type": "integer" },
          "version_patch": { "type": "integer" },
          "description": { "type": "string" },
          "tier": { "$ref": "#/components/schemas/VersionTier" },
          "is_released": { "type": "boolean" },
          "is_selected": { "type": "boolean" },
          "status": { "type": "string", "nullable": true },
          "created_at": { "type": "string", "format": "date-time" },
          "updated_at": { "type": "string", "format": "date-time" }
        }
      },
      "VersionListResponse": {
        "type": "object",
        "properties": {
          "versions": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/DocumentVersion" }
          },
          "userRole": { "$ref": "#/components/schemas/PermissionRole" }
        }
      },
      "VersionResponse": {
        "type": "object",
        "properties": {
          "version": { "$ref": "#/components/schemas/DocumentVersion" }
        }
      },
      "VersionContentResponse": {
        "type": "object",
        "description": "Response containing the effective document content at a specific version",
        "properties": {
          "version": { "$ref": "#/components/schemas/DocumentVersion" },
          "effectiveContent": { 
            "type": "object",
            "description": "The computed document content at this version (all patches applied)"
          },
          "versionString": { 
            "type": "string", 
            "description": "Human-readable version string (e.g., '1.2.3')",
            "example": "1.2.3"
          }
        }
      },
      "VersionDiffResponse": {
        "type": "object",
        "description": "Response containing the diff between two document versions. The structure varies based on the requested format.",
        "properties": {
          "fromVersion": { "$ref": "#/components/schemas/DocumentVersion" },
          "toVersion": { "$ref": "#/components/schemas/DocumentVersion" },
          "fromVersionString": { 
            "type": "string", 
            "description": "Human-readable source version string",
            "example": "1.0.0"
          },
          "toVersionString": { 
            "type": "string", 
            "description": "Human-readable target version string",
            "example": "1.1.0"
          },
          "fromContent": { 
            "type": "object",
            "description": "The effective document content at the source version (only present in 'complex' format)"
          },
          "toContent": { 
            "type": "object",
            "description": "The effective document content at the target version (only present in 'complex' format)"
          },
          "diff": {
            "type": "array",
            "description": "Array of JSON Patch-like operations describing the changes (only present in 'complex' format)",
            "items": {
              "type": "object",
              "properties": {
                "op": { 
                  "type": "string", 
                  "enum": ["add", "remove", "replace"],
                  "description": "The type of change"
                },
                "path": { 
                  "type": "string", 
                  "description": "JSON Pointer path to the changed value"
                },
                "value": { 
                  "description": "The new value (for add/replace operations)"
                },
                "oldValue": { 
                  "description": "The previous value (for remove/replace operations)"
                }
              }
            }
          },
          "simpleDiff": {
            "type": "string",
            "description": "Pseudo-JSON text showing structural changes (only present in 'simple' format). Additions are shown normally, removals are commented out using // for single-line or /* */ for multi-line, and modifications show both old (commented) and new values.",
            "example": "{\n  // oldTitle: \"Old Title\",\n  title: \"New Title\",\n  newProperty: \"value\",\n}"
          }
        }
      },
      "GetDocumentPermissionsRequest": {
        "type": "object",
        "required": ["action", "documentId"],
        "properties": {
          "action": { "type": "string", "enum": ["getDocumentPermissions"] },
          "documentId": { "type": "string", "format": "uuid" }
        }
      },
      "GetWorkspacePermissionsRequest": {
        "type": "object",
        "required": ["action", "workspaceId"],
        "properties": {
          "action": { "type": "string", "enum": ["getWorkspacePermissions"] },
          "workspaceId": { "type": "string", "format": "uuid" }
        }
      },
      "UpdatePermissionRequest": {
        "type": "object",
        "required": ["action", "permissionId", "role"],
        "properties": {
          "action": { "type": "string", "enum": ["updateDocumentPermission", "updateWorkspacePermission"] },
          "permissionId": { "type": "string", "format": "uuid" },
          "role": { "$ref": "#/components/schemas/PermissionRole" }
        }
      },
      "RemovePermissionRequest": {
        "type": "object",
        "required": ["action", "permissionId"],
        "properties": {
          "action": { "type": "string", "enum": ["removeDocumentPermission", "removeWorkspacePermission"] },
          "permissionId": { "type": "string", "format": "uuid" },
          "userEmail": { "type": "string", "format": "email" },
          "userName": { "type": "string" },
          "resourceName": { "type": "string" }
        }
      },
      "InviteToDocumentRequest": {
        "type": "object",
        "required": ["action", "documentId", "email", "role"],
        "properties": {
          "action": { "type": "string", "enum": ["inviteToDocument"] },
          "documentId": { "type": "string", "format": "uuid" },
          "email": { "type": "string", "format": "email" },
          "role": { "$ref": "#/components/schemas/PermissionRole" }
        }
      },
      "InviteToWorkspaceRequest": {
        "type": "object",
        "required": ["action", "workspaceId", "email", "role"],
        "properties": {
          "action": { "type": "string", "enum": ["inviteToWorkspace"] },
          "workspaceId": { "type": "string", "format": "uuid" },
          "email": { "type": "string", "format": "email" },
          "role": { "$ref": "#/components/schemas/PermissionRole" }
        }
      },
      "GetUserInvitationsRequest": {
        "type": "object",
        "required": ["action"],
        "properties": {
          "action": { "type": "string", "enum": ["getUserInvitations"] }
        }
      },
      "AcceptInvitationRequest": {
        "type": "object",
        "required": ["action", "invitationId", "invitationType"],
        "properties": {
          "action": { "type": "string", "enum": ["acceptInvitation"] },
          "invitationId": { "type": "string", "format": "uuid" },
          "invitationType": { "type": "string", "enum": ["workspace", "document"] }
        }
      },
      "DeclineInvitationRequest": {
        "type": "object",
        "required": ["action", "invitationId", "invitationType"],
        "properties": {
          "action": { "type": "string", "enum": ["declineInvitation"] },
          "invitationId": { "type": "string", "format": "uuid" },
          "invitationType": { "type": "string", "enum": ["workspace", "document"] }
        }
      },
      "Permission": {
        "type": "object",
        "properties": {
          "id": { "type": "string", "format": "uuid" },
          "user_id": { "type": "string", "format": "uuid" },
          "role": { "$ref": "#/components/schemas/PermissionRole" },
          "status": { "type": "string" },
          "granted_by": { "type": "string", "format": "uuid" },
          "user_email": { "type": "string", "format": "email" },
          "user_name": { "type": "string" },
          "username": { "type": "string" },
          "created_at": { "type": "string", "format": "date-time" },
          "updated_at": { "type": "string", "format": "date-time" }
        }
      },
      "PermissionListResponse": {
        "type": "object",
        "properties": {
          "permissions": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/Permission" }
          }
        }
      },
      "Invitation": {
        "type": "object",
        "properties": {
          "id": { "type": "string", "format": "uuid" },
          "type": { "type": "string", "enum": ["workspace", "document"] },
          "workspace_id": { "type": "string", "format": "uuid", "nullable": true },
          "document_id": { "type": "string", "format": "uuid", "nullable": true },
          "workspace_name": { "type": "string", "nullable": true },
          "document_name": { "type": "string", "nullable": true },
          "role": { "$ref": "#/components/schemas/PermissionRole" },
          "inviter_email": { "type": "string", "format": "email" },
          "inviter_name": { "type": "string" },
          "created_at": { "type": "string", "format": "date-time" }
        }
      },
      "InvitationListResponse": {
        "type": "object",
        "properties": {
          "invitations": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/Invitation" }
          }
        }
      },
      "GetUserNotificationsRequest": {
        "type": "object",
        "required": ["action"],
        "properties": {
          "action": { "type": "string", "enum": ["getUserNotifications"] }
        }
      },
      "MarkNotificationAsReadRequest": {
        "type": "object",
        "required": ["action", "notificationId"],
        "properties": {
          "action": { "type": "string", "enum": ["markNotificationAsRead"] },
          "notificationId": { "type": "string", "format": "uuid" }
        }
      },
      "MarkAllNotificationsAsReadRequest": {
        "type": "object",
        "required": ["action"],
        "properties": {
          "action": { "type": "string", "enum": ["markAllNotificationsAsRead"] }
        }
      },
      "CreateNotificationRequest": {
        "type": "object",
        "required": ["action", "documentId", "title", "message"],
        "properties": {
          "action": { "type": "string", "enum": ["createNotification"] },
          "documentId": { "type": "string", "format": "uuid" },
          "title": { "type": "string" },
          "message": { "type": "string" },
          "workspaceId": { "type": "string", "format": "uuid" },
          "type": { "type": "string" }
        }
      },
      "Notification": {
        "type": "object",
        "properties": {
          "id": { "type": "string", "format": "uuid" },
          "user_id": { "type": "string", "format": "uuid" },
          "document_id": { "type": "string", "format": "uuid", "nullable": true },
          "workspace_id": { "type": "string", "format": "uuid", "nullable": true },
          "type": { "type": "string" },
          "title": { "type": "string" },
          "message": { "type": "string" },
          "read_at": { "type": "string", "format": "date-time", "nullable": true },
          "created_at": { "type": "string", "format": "date-time" },
          "updated_at": { "type": "string", "format": "date-time" }
        }
      },
      "NotificationListResponse": {
        "type": "object",
        "properties": {
          "notifications": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/Notification" }
          },
          "unreadCount": { "type": "integer" }
        }
      },
      "NotificationResponse": {
        "type": "object",
        "properties": {
          "notification": { "$ref": "#/components/schemas/Notification" },
          "success": { "type": "boolean" }
        }
      },
      "GetUserProfileRequest": {
        "type": "object",
        "required": ["action"],
        "properties": {
          "action": { "type": "string", "enum": ["getUserProfile"] }
        }
      },
      "UpdateUserProfileRequest": {
        "type": "object",
        "required": ["action", "updates"],
        "properties": {
          "action": { "type": "string", "enum": ["updateUserProfile"] },
          "updates": {
            "type": "object",
            "properties": {
              "full_name": { "type": "string" },
              "username": { "type": "string" },
              "avatar_url": { "type": "string", "format": "uri" }
            }
          }
        }
      },
      "UserProfile": {
        "type": "object",
        "properties": {
          "id": { "type": "string", "format": "uuid" },
          "user_id": { "type": "string", "format": "uuid" },
          "email": { "type": "string", "format": "email" },
          "full_name": { "type": "string", "nullable": true },
          "username": { "type": "string", "nullable": true },
          "avatar_url": { "type": "string", "format": "uri", "nullable": true },
          "created_at": { "type": "string", "format": "date-time" },
          "updated_at": { "type": "string", "format": "date-time" }
        }
      },
      "UserProfileResponse": {
        "type": "object",
        "properties": {
          "profile": { "$ref": "#/components/schemas/UserProfile" },
          "success": { "type": "boolean" },
          "message": { "type": "string" }
        }
      },
      "PublicDocumentResponse": {
        "type": "object",
        "properties": {
          "content": { "type": "object" },
          "name": { "type": "string" },
          "workspace": { "type": "string", "nullable": true },
          "created_at": { "type": "string", "format": "date-time" },
          "updated_at": { "type": "string", "format": "date-time" },
          "document_id": { "type": "string", "format": "uuid" },
          "formatted_content": { "type": "string" }
        }
      },
      "PublicDiagramResponse": {
        "type": "object",
        "properties": {
          "id": { "type": "string", "format": "uuid" },
          "name": { "type": "string" },
          "content": { "type": "object" },
          "type": { "type": "string", "enum": ["diagram"] }
        }
      },
      "SuccessResponse": {
        "type": "object",
        "properties": {
          "success": { "type": "boolean" },
          "message": { "type": "string" }
        }
      },
      "ErrorResponse": {
        "type": "object",
        "properties": {
          "error": { "type": "string" }
        }
      }
    },
    "responses": {
      "BadRequest": {
        "description": "Bad request - invalid parameters or missing required fields",
        "content": {
          "application/json": {
            "schema": { "$ref": "#/components/schemas/ErrorResponse" }
          }
        }
      },
      "Unauthorized": {
        "description": "Unauthorized - missing or invalid authentication token or API key",
        "content": {
          "application/json": {
            "schema": { "$ref": "#/components/schemas/ErrorResponse" }
          }
        }
      },
      "Forbidden": {
        "description": "Forbidden - insufficient permissions or API key scope",
        "content": {
          "application/json": {
            "schema": { "$ref": "#/components/schemas/ErrorResponse" }
          }
        }
      },
      "NotFound": {
        "description": "Resource not found",
        "content": {
          "application/json": {
            "schema": { "$ref": "#/components/schemas/ErrorResponse" }
          }
        }
      },
      "InternalError": {
        "description": "Internal server error",
        "content": {
          "application/json": {
            "schema": { "$ref": "#/components/schemas/ErrorResponse" }
          }
        }
      }
    }
  }
}
